<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWSkills Mini-Hackathon: Train Model</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&family=Open+Sans:wght@400;600&family=Times+New+Roman&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Times New Roman', Times, serif;
            font-size: 16px;
        }
        .header-bg {
            background-color: #e6f3e6;
            border-bottom: 2px solid #2e7d32;
        }
        .main-section {
            background-color: #f1f8f9;
            padding: 3rem 0;
        }
        .accessibility-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: #fff;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            font-family: 'Open Sans', sans-serif;
        }
        .accessibility-btn:hover + .accessibility-menu, .accessibility-menu:hover {
            display: block;
        }
        h1, h2 {
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
        }
        .nav-link {
            font-family: 'Open Sans', sans-serif;
            font-weight: 600;
        }
        p, ul, li {
            font-family: 'Times New Roman', Times, serif;
            text-align: justify;
        }
        .header-logos {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }
        .navbar-nav {
            display: flex;
            justify-content: center;
            width: 100%;
        }
        .log-box {
            background: #e6f3e6;
            border: 1px solid #2e7d32;
            border-radius: 8px;
            padding: 1rem;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            color: #1a202c;
        }
        .btn-primary {
            background: linear-gradient(90deg, #06b6d4, #22c55e);
            color: #fff;
            border: none;
            padding: 0.7rem 1.2rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Header Section -->
    <div class="header-bg">
        <div class="container mx-auto px-4 py-2">
            <div class="flex flex-wrap justify-between items-center">
                <div class="flex space-x-4">
                    <ul class="flex space-x-4 text-sm">
                        <li>
                            <a href="https://pwskills.com/" target="_blank" class="text-green-700 hover:text-green-900" title="PWSkills Home" rel="noopener noreferrer">PWSkills Home</a>
                        </li>
                    </ul>
                </div>
                <div class="flex space-x-4 items-center">
                    <a href="#skipCont" class="text-green-700 hover:text-green-900" title="Skip to main content">Skip to main content</a>
                    <div class="relative">
                        <button class="accessibility-btn text-green-700 hover:text-green-900" title="Accessibility Tools">
                            <i class="fas fa-universal-access"></i>
                        </button>
                        <div class="accessibility-menu hidden p-4">
                            <div class="font-bold mb-2">Accessibility Tools</div>
                            <button class="block mb-2 text-sm" onclick="document.body.classList.toggle('high-contrast')">High Contrast</button>
                            <button class="block mb-2 text-sm" onclick="document.body.classList.toggle('dark-contrast')">Dark Contrast</button>
                            <div class="font-bold mb-2">Text Size</div>
                            <button class="block mb-2 text-sm" onclick="document.body.style.fontSize='1.2em'">Increase Text</button>
                            <button class="block mb-2 text-sm" onclick="document.body.style.fontSize='0.8em'">Decrease Text</button>
                            <button class="block mb-2 text-sm" onclick="document.body.style.fontSize='1em'">Reset Text</button>
                            <a href="https://pwskills.com/accessibility" target="_blank" class="block text-sm">Screen Reader</a>
                        </div>
                    </div>
                    <a href="https://www.facebook.com/pwskills" target="_blank" class="text-green-700" title="Facebook" rel="noopener noreferrer">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="https://x.com/pwskills" target="_blank" class="text-green-700" title="Twitter" rel="noopener noreferrer">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://www.youtube.com/@pwskills" target="_blank" class="text-green-700" title="YouTube" rel="noopener noreferrer">
                        <i class="fab fa-youtube"></i>
                    </a>
                    <a href="https://www.instagram.com/pwskills" target="_blank" class="text-green-700" title="Instagram" rel="noopener noreferrer">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
            </div>
        </div>
        <header class="bg-white shadow">
            <div class="container mx-auto px-4 py-4">
                <div class="header-logos">
                    <a href="/home" class="flex items-center">
                        <img src="https://couponzania.com/wp-content/uploads/2025/02/PW-Skills-Logo.webp" alt="PW Skills Logo" class="w-48">
                    </a>
                    <div class="flex items-center">
                        <img src="https://swachhbharatmission.ddws.gov.in/themes/custom/repo-theme-master/images/swach-bharat.png" alt="Swachh Bharat" class="w-24">
                    </div>
                </div>
            </div>
            <nav class="navbar navbar-expand-lg navbar-light bg-green-50">
                <div class="container mx-auto px-4">
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item"><a class="nav-link" href="/home">Home</a></li>
                            <li class="nav-item"><a class="nav-link active" href="/train">Train Model</a></li>
                            <li class="nav-item"><a class="nav-link" href="/predict">Predict</a></li>
                            <li class="nav-item"><a class="nav-link" href="https://pwskills.com/register" target="_blank">Register</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
    </div>

    <!-- Main Content: Training Section -->
    <main id="skipCont" class="main-section">
        <div class="container mx-auto px-4 py-8">
            <h1 class="text-3xl text-green-800 mb-6 text-center">Train the Recycling Rate Model</h1>
            <p class="text-gray-700 mb-4 text-justify">
                Use this page to train the machine learning model for predicting recycling rates. Click the button below to start the training process, and monitor the progress in the log output box.
            </p>
            <div class="mb-6">
                <button id="trainBtn" class="btn-primary">Train Model</button>
            </div>
            <h2 class="text-2xl text-blue-700 mb-4 text-center">Training Log</h2>
            <div id="logBox" class="log-box"></div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-green-800 text-white py-4">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 PWSkills. All rights reserved.</p>
            <p>
                <a href="https://pwskills.com/" class="text-green-200 hover:text-white">PWSkills</a> |
                <a href="https://swachhbharatmission.ddws.gov.in/" class="text-green-200 hover:text-white">Swachh Bharat Mission</a>
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Basic contrast and text size toggle functionality
        document.body.classList.add('transition-all', 'duration-300');
        document.querySelector('.high-contrast')?.addEventListener('click', () => {
            document.body.style.backgroundColor = '#000';
            document.body.style.color = '#fff';
        });
        document.querySelector('.dark-contrast')?.addEventListener('click', () => {
            document.body.style.backgroundColor = '#333';
            document.body.style.color = '#fff';
        });

        // Training button and log fetching
        const trainBtn = document.getElementById('trainBtn');
        const logBox = document.getElementById('logBox');

        function setBusy(btn, busy, textBusy = 'Working...') {
            btn.disabled = !!busy;
            if (busy) {
                btn.dataset.label = btn.textContent;
                btn.textContent = textBusy;
            } else {
                btn.textContent = btn.dataset.label || btn.textContent;
            }
        }

        trainBtn.addEventListener('click', async () => {
            setBusy(trainBtn, true, 'Training...');
            logBox.innerHTML = '<p>Initializing training...</p>';

            // Start polling logs from /logs
            const logInterval = setInterval(async () => {
                try {
                    const response = await fetch('/logs');
                    const data = await response.json();
                    if (data.status === 'success') {
                        logBox.innerHTML = '';
                        data.logs.forEach(log => {
                            const p = document.createElement('p');
                            p.textContent = log;
                            logBox.appendChild(p);
                        });
                        logBox.scrollTop = logBox.scrollHeight; // Auto-scroll
                    } else {
                        logBox.innerHTML += '<p>Error: ' + data.message + '</p>';
                    }
                } catch (error) {
                    logBox.innerHTML += '<p>Error fetching logs: ' + error.message + '</p>';
                }
            }, 1000);

            // Trigger training
            try {
                const res = await fetch('/train', { method: 'POST' });
                const data = await res.json();
                clearInterval(logInterval);
                if (data.status !== 'success') throw new Error(data.message || 'Training failed');
                logBox.innerHTML += '<p>Training completed successfully!</p>';
                logBox.scrollTop = logBox.scrollHeight;
            } catch (e) {
                clearInterval(logInterval);
                logBox.innerHTML += '<p>Error: ' + (e.message || 'Training failed') + '</p>';
                logBox.scrollTop = logBox.scrollHeight;
            } finally {
                setBusy(trainBtn, false);
            }
        });
    </script>
</body>
</html>